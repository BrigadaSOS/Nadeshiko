/** AUTOGENERATED - DO NOT EDIT **/
/* tslint:disable */
/* eslint-disable */

import { ExpressRuntimeError } from '@nahkies/typescript-express-runtime/errors';
import {
  type ExpressRuntimeResponder,
  ExpressRuntimeResponse,
  type Params,
  SkipResponse,
  type StatusCode,
} from '@nahkies/typescript-express-runtime/server';
import { responseValidationFactory } from '@nahkies/typescript-express-runtime/zod-v3';
import { type NextFunction, type Request, type Response, Router } from 'express';
import type { t_Error, t_LogoutResponse } from '../models.ts';
import { s_Error, s_LogoutResponse } from '../schemas.ts';

export type LogoutResponder = {
  with200(): ExpressRuntimeResponse<t_LogoutResponse>;
  with401(): ExpressRuntimeResponse<t_Error>;
  with429(): ExpressRuntimeResponse<t_Error>;
  with500(): ExpressRuntimeResponse<t_Error>;
} & ExpressRuntimeResponder;

export type Logout = (
  params: Params<void, void, void, void>,
  respond: LogoutResponder,
  req: Request,
  res: Response,
  next: NextFunction,
) => Promise<ExpressRuntimeResponse<unknown> | typeof SkipResponse>;

export type AuthjwtImplementation = {
  logout: Logout;
};

export function createAuthjwtRouter(implementation: AuthjwtImplementation): Router {
  const router = Router();

  const logoutResponseBodyValidator = responseValidationFactory(
    [
      ['200', s_LogoutResponse],
      ['401', s_Error],
      ['429', s_Error],
      ['500', s_Error],
    ],
    undefined,
  );

  // logout
  router.post(`/v1/auth/logout`, async (req: Request, res: Response, next: NextFunction) => {
    try {
      const input = {
        params: undefined,
        query: undefined,
        body: undefined,
        headers: undefined,
      };

      const responder = {
        with200() {
          return new ExpressRuntimeResponse<t_LogoutResponse>(200);
        },
        with401() {
          return new ExpressRuntimeResponse<t_Error>(401);
        },
        with429() {
          return new ExpressRuntimeResponse<t_Error>(429);
        },
        with500() {
          return new ExpressRuntimeResponse<t_Error>(500);
        },
        withStatus(status: StatusCode) {
          return new ExpressRuntimeResponse(status);
        },
      };

      const response = await implementation.logout(input, responder, req, res, next).catch((err) => {
        throw ExpressRuntimeError.HandlerError(err);
      });

      // escape hatch to allow responses to be sent by the implementation handler
      if (response === SkipResponse) {
        return;
      }

      const { status, body } = response instanceof ExpressRuntimeResponse ? response.unpack() : response;

      res.status(status);

      if (body !== undefined) {
        res.json(logoutResponseBodyValidator(status, body));
      } else {
        res.end();
      }
    } catch (error) {
      next(error);
    }
  });

  return router;
}

export { createAuthjwtRouter as createRouter };
export type { AuthjwtImplementation as Implementation };
