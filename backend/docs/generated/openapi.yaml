openapi: 3.1.0
info:
  title: Nadeshiko API
  description: |
    Welcome to the Nadeshiko API.

    ## Getting Started

    Nadeshiko uses API keys to grant access to the API. Authentication is performed using the Authorization header. Please note that you must be registered on Nadeshiko to generate an API key. If you haven't registered yet, please do so.

    If you haven't generated an API key yet, you can do so on your [account page](https://nadeshiko.co/settings/api), API section.

    ### Quotas and Limits
    The API has a rate limit to ensure fair usage. Each API key is subject to a rate limit of 2000 requests per 5 minutes. Exceeding this limit will result in a temporary block with the following message:
    > "Too many requests. Please try again later."

    Additionally, each account has a monthly quota limit. Once the monthly quota is exceeded, further requests will receive the message:
    > "API Key quota exceeded for this month."

    | Account Type | Quota (Monthly) |
    |--------------|-----------------|
    | Default      | 2500 requests   |

    To increase your quota, please contact the Nadeshiko team. For more information, refer to the [contact page](https://nadeshiko.co/about).
  version: 1.3.0
  contact:
    name: Nadeshiko Team
    url: https://nadeshiko.co
servers:
  - description: Local server
    url: http://localhost:5000
  - description: Production server
    url: https://api.nadeshiko.co
security:
  - apiKeyHeader: []
  - sessionCookie: []
tags:
  - name: Search
    description: |
      Search endpoints for querying Japanese sentences across indexed media.
  - name: Media
    description: |
      Media CRUD endpoints for managing anime and j-drama entries.
  - name: Lists
    description: |
      List endpoints for managing media collections and watch orders.
paths:
  /v1/search/health:
    get:
      tags:
        - Search
      operationId: searchHealthCheck
      summary: Health check for search
      description: |
        Tests the search service connectivity and functionality by performing a simple search query.

        **Requirements:**
        - Required Scopes: `READ_MEDIA`
      security:
        - apiKeyHeader:
            - READ_MEDIA
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchHealthCheckResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search/media/sentence:
    post:
      tags:
        - Search
      operationId: search
      summary: Search by query
      description: |
        The primary search endpoint for finding Japanese sentences and their translations across indexed media (anime, J-Drama, audiobooks).

        This endpoint uses Elasticsearch with advanced Japanese text analysis supporting multiple input types (romaji, kanji, kana) and providing intelligent field-based boosting.

        **Query Features**
        - **Multi-language Support:** Search using Japanese (kanji/kana), Romaji, or English/Spanish
        - **Boolean Operators:** `AND`, `OR`, `NOT` supported (e.g., `(cat OR dog) AND bird`)
        - **Phrase Matching:** Use quotes for exact phrases (e.g., `"good morning"`), or pass `exact_match: true` to the request body
        - **Wildcards:** `te*t` format (leading wildcards not supported)
        - **Smart Field Selection:** Automatically chooses optimal search fields based on input type

        **Input Type Handling**
        | Input Type | Search Strategy |
        |------------|-----------------|
        | **Romaji** (`go`, `taberu`) | Boosts EN/ES translations, reading form (pronunciation), and base form |
        | **Kanji** (`食べる`, `彼女`) | Searches content and base form (dictionary form). Ignores matches by reading (homophones). |
        | **Kana** (`たべる`, `かのじょ`) | Standard search across content, base form, and reading form |
        | **English/Spanish** | Direct translation search |

        **Requirements**
        - API Key with `READ_MEDIA` permission
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                ValidationFailed:
                  $ref: '#/components/examples/ValidationFailed'
                InvalidJson:
                  $ref: '#/components/examples/InvalidJson'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search/media/match/words:
    post:
      tags:
        - Search
      operationId: searchMultiple
      summary: Search by multiple queries
      description: |
        Searches for multiple words simultaneously and aggregates results by media.

        Unlike the main search endpoint, this returns a summary of matches per media rather than individual sentence segments.

        **Use Cases**
        - Vocabulary discovery across media library
        - Finding anime/dramas that use specific words
        - Comparing word usage across different titles

        **Requirements:**
        - Required Scopes: `READ_MEDIA`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchMultipleRequest'
            example:
              words:
                - 彼女
                - 私
              exact_match: false
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchMultipleResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                ValidationFailed:
                  $ref: '#/components/examples/ValidationFailed'
                InvalidJson:
                  $ref: '#/components/examples/InvalidJson'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search/media/context:
    post:
      tags:
        - Search
      operationId: fetchSentenceContext
      summary: Fetch context for a sentence
      description: |
        Retrieves sentences surrounding a specific segment position within an episode.
        Returns segments both before and after the target position, providing context for understanding how a sentence is used in dialogue.

        **Requirements:**
        - Required scopes: `READ_MEDIA`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FetchSentenceContextRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FetchSentenceContextResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                ValidationFailed:
                  $ref: '#/components/examples/ValidationFailed'
                InvalidJson:
                  $ref: '#/components/examples/InvalidJson'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                NotFound:
                  $ref: '#/components/examples/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/search/media/info:
    get:
      tags:
        - Search
      operationId: fetchMediaInfo
      summary: Fetch media info
      description: |
        Lists available media with metadata and supports filtering by type and search query.

        Returns paginated results with comprehensive media information including cover/banner images, episode counts, and genres.

        **Use Cases**
        - Browsing the media library
        - Getting media metadata for display

        **Requirements:**
        - Required Scopes: `READ_MEDIA`
      parameters:
        - name: size
          in: query
          description: Number of results per page
          schema:
            type: integer
            default: 20
        - name: cursor
          in: query
          description: Pagination cursor offset
          schema:
            type: integer
            default: 0
        - name: query
          in: query
          description: Search query for filtering media
          schema:
            type: string
            example: steins
        - name: type
          in: query
          description: Filter by media category
          schema:
            type: string
            enum:
              - anime
              - liveaction
              - audiobook
            example: anime
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FetchMediaInfoResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media:
    get:
      tags:
        - Media
      operationId: mediaIndex
      summary: List all media
      description: |
        Returns a paginated list of media with full metadata, including cover/banner images, episode counts, and genres.
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: limit
          in: query
          description: Number of results per page
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 40
        - name: cursor
          in: query
          description: Pagination cursor offset
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: category
          in: query
          description: Filter by media category
          schema:
            type: string
            enum:
              - ANIME
              - JDRAMA
            example: ANIME
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MediaListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/{id}:
    get:
      tags:
        - Media
      operationId: mediaShow
      summary: Get single media
      description: |
        Retrieves a single media entry by its ID.
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: id
          in: path
          required: true
          description: Media ID
          schema:
            type: integer
            example: 7674
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Media'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/{mediaId}/episodes:
    get:
      operationId: episodeIndex
      tags:
        - Media
      summary: List episodes for a media
      description: |
        Get a paginated list of episodes for a specific media
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: mediaId
          in: path
          required: true
          schema:
            type: integer
          description: ID of the media
          example: 7674
        - name: size
          in: query
          required: false
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Maximum number of episodes to return
          example: 50
        - name: cursor
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Episode number to start from (for pagination)
          example: 10
      responses:
        '200':
          $ref: '#/components/responses/EpisodeListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/{mediaId}/episodes/{episodeNumber}:
    get:
      operationId: episodeShow
      tags:
        - Media
      summary: Get single episode
      description: |
        Get a specific episode by media ID and episode number
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: mediaId
          in: path
          required: true
          schema:
            type: integer
          description: ID of the media
          example: 7674
        - name: episodeNumber
          in: path
          required: true
          schema:
            type: integer
          description: Episode number
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/EpisodeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/{mediaId}/episodes/{episodeNumber}/segments/{id}:
    get:
      operationId: segmentShow
      tags:
        - Media
      summary: Get single segment
      description: |
        Get a specific segment by ID
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: mediaId
          in: path
          required: true
          schema:
            type: integer
          description: ID of the media
          example: 7674
        - name: episodeNumber
          in: path
          required: true
          schema:
            type: integer
          description: Episode number
          example: 1
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Segment ID
          example: 12345
      responses:
        '200':
          $ref: '#/components/responses/SegmentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/segments/{uuid}:
    get:
      tags:
        - Media
      operationId: segmentShowByUuid
      summary: Get segment by UUID
      description: |
        Get a specific segment by its UUID
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: uuid
          in: path
          required: true
          schema:
            type: string
          description: Segment UUID
          example: 3fd94cef-a3e1-31ae-bc8d-e743f03e9c7e
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Segment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/characters/{id}:
    get:
      tags:
        - Media
      operationId: characterShow
      summary: Get character details
      description: |
        Returns a character with their seiyuu and all media appearances.
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: id
          in: path
          required: true
          description: AniList character ID
          schema:
            type: integer
            example: 14545
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CharacterWithMedia'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/media/seiyuu/{id}:
    get:
      tags:
        - Media
      operationId: seiyuuShow
      summary: Get seiyuu details
      description: |
        Returns a voice actor with all characters they voiced and media appearances.
      security:
        - apiKeyHeader:
            - READ_MEDIA
      parameters:
        - name: id
          in: path
          required: true
          description: AniList staff ID
          schema:
            type: integer
            example: 95991
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeiyuuWithRoles'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/lists:
    get:
      tags:
        - Lists
      operationId: listIndex
      summary: List all lists
      description: |
        Returns all lists matching the query filters. Can filter by media ID to find lists containing a specific media. Public lists are visible to all users.
      security:
        - apiKeyHeader:
            - READ_LISTS
      parameters:
        - name: visibility
          in: query
          description: Filter by visibility
          schema:
            type: string
            enum:
              - public
              - private
            example: public
        - name: type
          in: query
          description: Filter by list type
          schema:
            type: string
            enum:
              - SERIES
              - CUSTOM
            example: SERIES
        - name: userId
          in: query
          description: Filter by list owner user ID
          schema:
            type: integer
            example: 1
        - name: mediaId
          in: query
          description: Filter lists containing this media ID
          schema:
            type: integer
            example: 12345
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/List'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/lists/{id}:
    get:
      tags:
        - Lists
      operationId: listShow
      summary: Get list details
      description: |
        Returns a list with all media in order (sorted by position).
      security:
        - apiKeyHeader:
            - READ_LISTS
      parameters:
        - name: id
          in: path
          required: true
          description: List ID
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListWithMedia'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/reindex:
    post:
      tags:
        - Admin
      operationId: reindexElasticsearch
      summary: Reindex database into Elasticsearch
      description: |
        Reindexes segments from the PostgreSQL database into Elasticsearch.
        Allows filtering by specific media IDs or episodes.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission for reindexing)

        **Behavior:**
        - If no filters provided, reindexes all segments
        - If `mediaIds` provided, reindexes all segments from those media
        - If `episodes` provided, reindexes only the specified episodes
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReindexRequest'
      responses:
        '200':
          description: Reindex operation completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReindexResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/queues/stats:
    get:
      tags:
        - Admin
      operationId: getQueueStats
      summary: Get queue statistics
      description: |
        Get statistics for all ES sync queues including pending and failed job counts.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission)

        **Use cases:**
        - Monitor queue health
        - Detect stuck jobs
        - Check backlog size
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      responses:
        '200':
          description: Queue statistics retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    queue:
                      type: string
                      example: es-sync-create
                    stuckCount:
                      type: integer
                      description: Number of jobs currently pending/active
                      example: 5
                    failedCount:
                      type: integer
                      description: Number of failed jobs
                      example: 2
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/queues/{queueName}:
    get:
      tags:
        - Admin
      operationId: getQueueDetails
      summary: Get detailed queue information
      description: |
        Get detailed information about a specific queue including completed, expired, and cancelled jobs.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission)

        **Queue names:**
        - `es-sync-create` - Jobs to create new segments
        - `es-sync-update` - Jobs to update existing segments
        - `es-sync-delete` - Jobs to delete segments
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      parameters:
        - name: queueName
          in: path
          required: true
          schema:
            type: string
            enum:
              - es-sync-create
              - es-sync-update
              - es-sync-delete
          description: The name of the queue
          example: es-sync-create
      responses:
        '200':
          description: Queue details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  queue:
                    type: string
                    example: es-sync-create
                  size:
                    type: integer
                    description: Current queue size (pending jobs)
                    example: 10
                  created:
                    type: integer
                    description: Total jobs created
                    example: 1250
                  failed:
                    type: integer
                    description: Total failed jobs
                    example: 5
                  complete:
                    type: integer
                    description: Total completed jobs
                    example: 1235
                  expired:
                    type: integer
                    description: Total expired jobs
                    example: 2
                  cancelled:
                    type: integer
                    description: Total cancelled jobs
                    example: 3
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/queues/{queueName}/failed:
    get:
      tags:
        - Admin
      operationId: getFailedJobs
      summary: Get failed jobs from a queue
      description: |
        Get jobs that have exceeded their retry limit and permanently failed.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission)

        **Use cases:**
        - Identify segments that failed to sync to Elasticsearch
        - Debug persistent sync issues
        - Decide whether to retry or purge failed jobs
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      parameters:
        - name: queueName
          in: path
          required: true
          schema:
            type: string
            enum:
              - es-sync-create
              - es-sync-update
              - es-sync-delete
          description: The name of the queue
          example: es-sync-create
      responses:
        '200':
          description: Failed jobs retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      description: Job ID
                    segmentId:
                      type: integer
                      description: The segment ID that failed to sync
                    error:
                      type: string
                      nullable: true
                      description: Error message from the last attempt
                    createdOn:
                      type: string
                      format: date-time
                      description: When the job was created
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/queues/{queueName}/retry:
    post:
      tags:
        - Admin
      operationId: retryQueueJobs
      summary: Retry failed jobs from a queue
      description: |
        Retry all failed jobs from a specific queue.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission)

        **Use cases:**
        - Retry jobs that failed due to temporary Elasticsearch issues
        - Recover from network blips
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      parameters:
        - name: queueName
          in: path
          required: true
          schema:
            type: string
            enum:
              - es-sync-create
              - es-sync-update
              - es-sync-delete
          description: The name of the queue
          example: es-sync-create
      responses:
        '200':
          description: Jobs queued for retry
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  retriedCount:
                    type: integer
                    description: Number of jobs queued for retry
                    example: 5
                  message:
                    type: string
                    example: Retried 5 failed jobs from es-sync-create
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/admin/queues/{queueName}/purge:
    delete:
      tags:
        - Admin
      operationId: purgeFailedJobs
      summary: Delete failed jobs from a queue
      description: |
        Permanently delete all failed jobs from a queue.

        **Requirements:**
        - Required Scopes: `ADD_MEDIA` (admin-level permission)

        **Use cases:**
        - Clean up old failed jobs after investigating
        - Reset a queue after fixing the underlying issue
        - Note: This does NOT re-sync the segments - use the reindex endpoint for that
      security:
        - apiKeyHeader:
            - ADD_MEDIA
      parameters:
        - name: queueName
          in: path
          required: true
          schema:
            type: string
            enum:
              - es-sync-create
              - es-sync-update
              - es-sync-delete
          description: The name of the queue
          example: es-sync-create
      responses:
        '200':
          description: Failed jobs purged successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  purgedCount:
                    type: integer
                    description: Number of failed jobs deleted
                    example: 15
                  message:
                    type: string
                    example: Purged 15 failed jobs from es-sync-create
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/UnauthorizedApiKey'
        '403':
          $ref: '#/components/responses/Forbidden'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    apiKeyHeader:
      type: http
      scheme: bearer
      bearerFormat: APIKey
      description: API key authentication via Authorization Bearer header
    sessionCookie:
      type: apiKey
      in: cookie
      name: nadeshiko.session_token
      description: Session authentication via better-auth cookie
  schemas:
    Category:
      type: string
      description: Media category type
      enum:
        - ANIME
        - JDRAMA
      example: ANIME
      x-enum-descriptions:
        - value: ANIME
          description: Anime
        - value: JDRAMA
          description: Japanese Drama
    Statistic:
      type: object
      description: Search result statistics grouped by anime/media
      properties:
        animeId:
          type: integer
          description: Unique identifier for the anime/media
          example: 110316
        category:
          $ref: '#/components/schemas/Category'
        nameAnimeRomaji:
          type: string
          description: Romaji transliteration of the anime name
          example: Steins;Gate
        nameAnimeEn:
          type: string
          description: English translation of the anime name
          example: Steins;Gate
        nameAnimeJp:
          type: string
          description: Original Japanese name of the anime
          example: シュタインズ・ゲート
        amountSentencesFound:
          type: integer
          description: Total number of sentences found for this anime
          example: 42
        seasonWithEpisodeHits:
          type: object
          description: Nested object mapping seasons to episodes with hit counts
          example:
            '1':
              '1': 5
              '2': 8
              '3': 3
          additionalProperties:
            type: object
            additionalProperties:
              type: integer
    CategoryStatistic:
      type: object
      description: Statistics grouped by media category
      properties:
        category:
          $ref: '#/components/schemas/Category'
        count:
          type: integer
          description: Number of entries in this category
          example: 1523
    BasicInfo:
      type: object
      description: Basic anime/media information included in search results
      required:
        - animeId
        - nameAnimeRomaji
        - episode
        - season
        - category
      properties:
        animeId:
          type: integer
          description: Unique identifier for the anime/media
          example: 110316
        nameAnimeRomaji:
          type: string
          description: Romaji transliteration of the anime name
          example: Steins;Gate
        nameAnimeEn:
          type: string
          description: English translation of the anime name
          example: Steins;Gate
        nameAnimeJp:
          type: string
          description: Original Japanese name of the anime
          example: シュタインズ・ゲート
        cover:
          type: string
          format: uri
          description: URL to the cover image
          example: https://example.com/media/anime/steins-gate/cover.jpg
        banner:
          type: string
          format: uri
          description: URL to the banner image
          example: https://example.com/media/anime/steins-gate/banner.jpg
        episode:
          type: integer
          description: Episode number where the segment appears
          example: 1
        season:
          type: integer
          description: Season number where the segment appears
          example: 1
        category:
          $ref: '#/components/schemas/Category'
    SegmentInfo:
      type: object
      description: Detailed information about a subtitle segment
      required:
        - status
        - uuid
        - position
        - startTime
        - endTime
        - contentJp
        - contentEnMt
        - contentEsMt
        - isNsfw
      properties:
        status:
          type: integer
          description: Segment status (0=Deleted, 1=Active, 2=Suspended, 3=Verified, 100=Invalid Sentence, 101=Sentence Too Long)
          example: 1
        uuid:
          type: string
          format: uuid
          description: Unique identifier for the segment
          example: 3fd94cef-a3e1-31ae-bc8d-e743f03e9c7e
        position:
          type: integer
          description: Position of the segment within the episode
          example: 1133
        startTime:
          type: string
          description: Timestamp in H:MM:SS.ffffff format (variable-length hours, microseconds) indicating when the segment starts
          example: '0:33:27.255000'
        endTime:
          type: string
          description: Timestamp in H:MM:SS.ffffff format (variable-length hours, microseconds) indicating when the segment ends
          example: '0:33:28.464000'
        contentJp:
          type: string
          description: Original Japanese content of the segment
          example: 僕は僕で、君は君だ。
        contentJpHighlight:
          type: string
          description: Japanese content with search terms highlighted
          example: <em>僕</em>は<em>僕</em>で、<em>君</em>は<em>君</em>だ。
        contentEn:
          type: string
          description: English translation of the segment content
          example: I am me, and you are you.
        contentEnHighlight:
          type: string
          description: English content with search terms highlighted
          example: <em>I</em> am <em>me</em>, and <em>you</em> are <em>you</em>.
        contentEnMt:
          type: boolean
          description: Indicates whether the English translation was machine-translated
          example: false
        contentEs:
          type: string
          description: Spanish translation of the segment content
          example: Yo soy yo, y tú eres tú.
        contentEsHighlight:
          type: string
          description: Spanish content with search terms highlighted
          example: <em>Yo</em> soy <em>yo</em>, y <em>tú</em> eres <em>tú</em>.
        contentEsMt:
          type: boolean
          description: Indicates whether the Spanish translation was machine-translated
          example: false
        isNsfw:
          type: boolean
          description: Indicates whether the segment contains NSFW (Not Safe For Work) content
          example: false
        actorJa:
          type: string
          description: Name of the Japanese voice actor for this segment
          example: Mamoru Miyano
        actorEn:
          type: string
          description: Name of the English voice actor for this segment
          example: J. Michael Tatum
        actorEs:
          type: string
          description: Name of the Spanish voice actor for this segment
          example: Alejandro Levis
    MediaInfoPath:
      type: object
      description: URLs to media resources for a segment
      properties:
        pathImage:
          type: string
          format: uri
          description: URL to the subtitle image snapshot
          example: https://example.com/media/anime/steins-gate/segments/1133.jpg
        pathAudio:
          type: string
          format: uri
          description: URL to the audio clip for this segment
          example: https://example.com/media/anime/steins-gate/audio/1133.mp3
        pathVideo:
          type: string
          format: uri
          description: URL to the video clip for this segment
          example: https://example.com/media/anime/steins-gate/video/1133.mp4
    Sentence:
      type: object
      description: A complete sentence result combining basic info, segment details, and media paths
      required:
        - basicInfo
        - segmentInfo
        - mediaInfo
      properties:
        basicInfo:
          $ref: '#/components/schemas/BasicInfo'
          description: Basic anime/media information
        segmentInfo:
          $ref: '#/components/schemas/SegmentInfo'
          description: Detailed segment information including translations
        mediaInfo:
          $ref: '#/components/schemas/MediaInfoPath'
          description: URLs to media resources (images, audio, video)
    SearchHealthCheckResponse:
      type: object
      properties:
        statistics:
          type: array
          items:
            $ref: '#/components/schemas/Statistic'
        categoryStatistics:
          type: array
          items:
            $ref: '#/components/schemas/CategoryStatistic'
        sentences:
          type: array
          items:
            $ref: '#/components/schemas/Sentence'
        cursor:
          type: array
          items:
            type: number
          description: Cursor for pagination
    Error:
      type: object
      description: Error Response schema for all cases
      required:
        - code
        - title
        - detail
        - status
      properties:
        code:
          type: string
          description: Specific error code for programmatic handling
        title:
          type: string
          description: A short, human-readable summary of the problem
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence
        type:
          type: string
          format: uri
          description: A URI reference that identifies the problem type (e.g., GitHub issues link)
        instance:
          type: string
          description: A URI reference that identifies the specific occurrence (e.g., trace ID)
        status:
          type: integer
          description: The HTTP status code
        errors:
          type: object
          additionalProperties:
            type: string
          description: Optional map of field names to their error messages (for validation errors)
    SearchRequest:
      type: object
      properties:
        query:
          type: string
          description: Text or sentence to search (null to search without query)
          example: 彼女
        limit:
          type: integer
          description: Max amount of entries by response
          default: 10
        uuid:
          type: string
          format: uuid
          description: Unique ID from sentence (Useful to get a specific sentence)
          example: 3fd94cef-a3e1-31ae-bc8d-e743f03e9c7e
        category:
          type: array
          description: Media category filter
          items:
            $ref: '#/components/schemas/Category'
          default:
            - ANIME
            - JDRAMA
        animeId:
          type: integer
          description: Unique ID from media
          example: 5
        season:
          type: array
          description: Array of seasons to get
          items:
            type: integer
          example:
            - 1
        episode:
          type: array
          description: Array of episodes to get
          items:
            type: integer
          example:
            - 5
            - 8
        randomSeed:
          type: integer
          description: Non-negative integer seed for deterministic random sorting
          minimum: 0
          example: 42
        contentSort:
          type: string
          description: Order by amount of characters
          enum:
            - asc
            - desc
            - none
            - time_asc
            - time_desc
            - random
          example: none
          default: none
        cursor:
          type: array
          description: Current page of search
          items:
            type: number
          example:
            - 23.31727
            - 7
        exactMatch:
          type: boolean
          description: Whether to use exact phrase matching
          default: false
        extra:
          type: boolean
          description: Include extra content
          default: false
        minLength:
          type: integer
          description: Minimum content length
          example: 10
        maxLength:
          type: integer
          description: Maximum content length
          example: 50
        excludedAnimeIds:
          type: array
          items:
            type: integer
          description: Anime IDs to exclude from results
          default: []
        status:
          type: array
          description: Segment status filter
          items:
            type: integer
          default:
            - 1
        media:
          type: array
          description: Media filter with seasons and episodes
          items:
            type: object
            required:
              - mediaId
              - seasons
            properties:
              mediaId:
                type: integer
                example: 123
              seasons:
                type: array
                items:
                  type: object
                  required:
                    - season
                    - episodes
                  properties:
                    season:
                      type: number
                      example: 1
                    episodes:
                      type: array
                      items:
                        type: number
                      example:
                        - 1
                        - 2
    SearchResponse:
      type: object
      properties:
        statistics:
          type: array
          items:
            $ref: '#/components/schemas/Statistic'
        categoryStatistics:
          type: array
          items:
            $ref: '#/components/schemas/CategoryStatistic'
        sentences:
          type: array
          items:
            $ref: '#/components/schemas/Sentence'
        cursor:
          type: array
          nullable: true
          items:
            type: number
          description: Cursor for pagination
    SearchMultipleRequest:
      type: object
      properties:
        words:
          type: array
          items:
            type: string
          description: List of words to search for
          example:
            - 彼女
            - 私
        exactMatch:
          type: boolean
          default: false
          description: Whether to use exact matching
          example: false
      required:
        - words
    WordMatchMedia:
      type: object
      description: Media entry containing word matches
      properties:
        mediaId:
          type: integer
          description: Unique identifier for the media
          example: 110316
        englishName:
          type: string
          description: English translation of the media name
          example: Steins;Gate
        japaneseName:
          type: string
          description: Original Japanese name of the media
          example: シュタインズ・ゲート
        romajiName:
          type: string
          description: Romaji transliteration of the media name
          example: Steins;Gate
        matches:
          type: integer
          description: Number of times the word appears in this media
          example: 234
    WordMatch:
      type: object
      description: Word matching result with occurrences across media
      properties:
        word:
          type: string
          description: The word that was searched for
          example: 彼女
        isMatch:
          type: boolean
          description: Indicates whether the word was found in any segment
          example: true
        totalMatches:
          type: integer
          description: Total number of times this word appears across all media
          example: 1523
        media:
          type: array
          description: List of media containing this word
          items:
            $ref: '#/components/schemas/WordMatchMedia'
    SearchMultipleResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/WordMatch'
    FetchSentenceContextRequest:
      type: object
      required:
        - mediaId
        - season
        - episode
        - segmentPosition
      properties:
        mediaId:
          type: integer
          description: Media ID
          example: 110316
        season:
          type: integer
          description: Season number
          minimum: 0
          example: 1
        episode:
          type: integer
          description: Episode number
          minimum: 0
          example: 5
        segmentPosition:
          type: integer
          description: Segment position in the episode
          minimum: 0
          example: 1133
        limit:
          type: integer
          description: Number of surrounding segments to retrieve
          minimum: 0
          default: 5
          example: 5
    FetchSentenceContextResponse:
      type: object
      required:
        - sentences
      properties:
        sentences:
          type: array
          items:
            $ref: '#/components/schemas/Sentence'
    MediaInfoStats:
      type: object
      description: Statistics about media and segments in the database
      properties:
        totalAnimes:
          type: integer
          description: Number of anime/media entries in the current result set
          example: 15
        totalSegments:
          type: integer
          description: Number of subtitle segments in the current result set
          example: 150
        fullTotalAnimes:
          type: integer
          description: Total number of anime/media entries in the entire database
          example: 5234
        fullTotalSegments:
          type: integer
          description: Total number of subtitle segments in the entire database
          example: 1523847
    MediaInfoData:
      type: object
      description: Complete information about a media/anime entry
      properties:
        id:
          type: integer
          description: Unique identifier for the media
          example: 110316
        anilistId:
          type: integer
          nullable: true
          description: AniList database ID for the media
          example: 21459
        tmdbId:
          type: integer
          nullable: true
          description: TMDB (The Movie Database) ID for the media
          example: 63726
        category:
          $ref: '#/components/schemas/Category'
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the media entry was created in the database
          example: '2024-01-15T10:30:00Z'
        updatedAt:
          type: integer
          description: Timestamp when the media entry was last updated
          example: 1705769100
        romajiName:
          type: string
          description: Romaji transliteration of the media name
          example: Steins;Gate
        englishName:
          type: string
          description: English translation of the media name
          example: Steins;Gate
        japaneseName:
          type: string
          description: Original Japanese name of the media
          example: シュタインズ・ゲート
        airingFormat:
          type: string
          description: Format of the media release (e.g., TV, OVA, Movie)
          example: TV
        airingStatus:
          type: string
          description: Current airing status (FINISHED, RELEASING)
          example: FINISHED
        startDate:
          type: string
          format: date
          description: Start date of the media (YYYY-MM-DD)
          example: '2011-04-06'
        endDate:
          type: string
          format: date
          nullable: true
          description: End date of the media (null if unknown) (YYYY-MM-DD)
          example: '2011-09-14'
        folderMediaName:
          type: string
          description: Folder name used for storing media files
          example: steins-gate
        genres:
          type: array
          items:
            type: string
          description: List of genres associated with the media
          example:
            - Sci-Fi
            - Thriller
            - Romance
        cover:
          type: string
          format: uri
          description: URL to the cover image
          example: https://example.com/media/anime/steins-gate/cover.jpg
        banner:
          type: string
          format: uri
          description: URL to the banner image
          example: https://example.com/media/anime/steins-gate/banner.jpg
        version:
          type: string
          description: Version identifier for the media entry
          example: v1.0
        numSegments:
          type: integer
          description: Total number of subtitle segments available
          example: 18542
        numSeasons:
          type: integer
          description: Total number of seasons available
          example: 1
        numEpisodes:
          type: integer
          description: Total number of episodes available
          example: 24
      required:
        - id
    FetchMediaInfoResponse:
      type: object
      properties:
        stats:
          $ref: '#/components/schemas/MediaInfoStats'
        results:
          type: array
          items:
            $ref: '#/components/schemas/MediaInfoData'
        cursor:
          type: integer
          description: Next cursor for pagination
        hasMoreResults:
          type: boolean
          description: Whether more results are available
    Seiyuu:
      type: object
      description: Japanese voice actor (seiyuu)
      required:
        - id
        - nameJapanese
        - nameEnglish
        - imageUrl
      properties:
        id:
          type: integer
          description: AniList staff ID
          example: 95991
        nameJapanese:
          type: string
          description: Japanese name of the voice actor
          example: 阿部敦
        nameEnglish:
          type: string
          description: English name of the voice actor
          example: Atsushi Abe
        imageUrl:
          type: string
          format: uri
          description: Profile image URL
          example: https://s4.anilist.co/file/anilistcdn/staff/large/n95991.jpg
    Character:
      type: object
      description: Anime character
      required:
        - id
        - nameJapanese
        - nameEnglish
        - imageUrl
        - seiyuu
      properties:
        id:
          type: integer
          description: AniList character ID
          example: 14545
        nameJapanese:
          type: string
          description: Japanese name of the character
          example: 真城最高
        nameEnglish:
          type: string
          description: English name of the character
          example: Moritaka Mashiro
        imageUrl:
          type: string
          format: uri
          description: Character image URL
          example: https://s4.anilist.co/file/anilistcdn/character/large/b14545.jpg
        seiyuu:
          $ref: '#/components/schemas/Seiyuu'
    MediaCharacter:
      type: object
      description: Character appearing in a media with their role
      required:
        - character
        - role
      properties:
        character:
          $ref: '#/components/schemas/Character'
        role:
          type: string
          enum:
            - MAIN
            - SUPPORTING
            - BACKGROUND
          description: Character's role in the media
          example: MAIN
    List:
      type: object
      description: Media collection list
      required:
        - id
        - name
        - type
        - userId
        - visibility
      properties:
        id:
          type: integer
          description: List ID
          example: 123
        name:
          type: string
          description: Name of the list
          example: Bakuman Series
        type:
          type: string
          enum:
            - SERIES
            - CUSTOM
          description: Type of list
          example: SERIES
        userId:
          type: integer
          description: User ID who owns the list (1 = admin)
          example: 1
        visibility:
          type: string
          enum:
            - PUBLIC
            - PRIVATE
          description: Visibility of the list
          example: PUBLIC
    Media:
      type: object
      description: Media entry with full metadata
      required:
        - id
        - anilistId
        - japaneseName
        - romajiName
        - englishName
        - airingFormat
        - airingStatus
        - genres
        - coverUrl
        - bannerUrl
        - startDate
        - category
        - version
        - studio
        - seasonName
        - seasonYear
      properties:
        id:
          type: integer
          description: Unique identifier for the media
          example: 7674
        anilistId:
          type: integer
          description: AniList database ID for the media
          example: 7674
        japaneseName:
          type: string
          description: Original Japanese name of the media
          example: バクマン。
        romajiName:
          type: string
          description: Romaji transliteration of the media name
          example: Bakuman.
        englishName:
          type: string
          description: English translation of the media name
          example: Bakuman.
        airingFormat:
          type: string
          description: Format of the media release (e.g., TV, OVA, Movie)
          example: TV
        airingStatus:
          type: string
          description: Current airing status (FINISHED, RELEASING, NOT_YET_RELEASED, CANCELLED)
          example: FINISHED
        genres:
          type: array
          items:
            type: string
          description: List of genres associated with the media
          example:
            - Comedy
            - Drama
            - Romance
            - Slice of Life
        coverUrl:
          type: string
          format: uri
          description: Full URL to the cover image
          example: https://cdn.example.com/media/anime/bakuman/cover.webp
        bannerUrl:
          type: string
          format: uri
          description: Full URL to the banner image
          example: https://cdn.example.com/media/anime/bakuman/banner.webp
        startDate:
          type: string
          format: date
          description: Start date of the media (first airing/release)
          example: '2010-10-02'
        endDate:
          type: string
          format: date
          nullable: true
          description: End date of the media (last airing/release)
          example: '2011-04-02'
        category:
          $ref: '#/components/schemas/Category'
        numSegments:
          type: integer
          description: Total number of subtitle segments available
          example: 0
        numEpisodes:
          type: integer
          description: Total number of episodes available
          example: 25
        version:
          type: string
          description: Version identifier for the media entry
          example: '6'
        studio:
          type: string
          description: Animation studio that produced the media
          example: J.C.STAFF
        seasonName:
          type: string
          description: Season when the media aired (WINTER, SPRING, SUMMER, FALL)
          example: FALL
        seasonYear:
          type: integer
          description: Year when the media aired
          example: 2010
        characters:
          type: array
          items:
            $ref: '#/components/schemas/MediaCharacter'
          description: Characters appearing in the media with their voice actors
        lists:
          type: array
          items:
            $ref: '#/components/schemas/List'
          description: Lists that contain this media
    MediaListResponse:
      type: object
      required:
        - data
        - hasMoreResults
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Media'
        cursor:
          type: integer
          description: Next cursor for pagination (undefined if no more results)
        hasMoreResults:
          type: boolean
          description: Whether more results are available
    Episode:
      type: object
      required:
        - mediaId
        - episodeNumber
        - numSegments
      properties:
        mediaId:
          type: integer
          description: ID of the media this episode belongs to
          example: 7674
        episodeNumber:
          type: integer
          description: Episode number within the media
          example: 1
        anilistEpisodeId:
          type: integer
          nullable: true
          description: AniList episode ID for external reference
          example: 123456
        titleEnglish:
          type: string
          nullable: true
          description: English title of the episode
          example: The Beginning
        titleRomaji:
          type: string
          nullable: true
          description: Romanized title of the episode
          example: Hajimari
        titleJapanese:
          type: string
          nullable: true
          description: Japanese title of the episode
          example: 始まり
        description:
          type: string
          nullable: true
          description: Episode description or synopsis
          example: The hero begins their journey
        airedAt:
          type: string
          format: date-time
          nullable: true
          description: When the episode originally aired
          example: '2024-01-15T09:00:00Z'
        lengthSeconds:
          type: integer
          nullable: true
          description: Episode duration in seconds
          example: 1420
        thumbnailUrl:
          type: string
          nullable: true
          description: URL to episode thumbnail image
          example: https://example.com/thumbnails/episode1.jpg
        numSegments:
          type: integer
          description: Number of segments in this episode
          example: 450
    EpisodeListResponse:
      type: object
      required:
        - data
        - hasMoreResults
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Episode'
          description: Array of episode objects
        cursor:
          type: integer
          description: Cursor for pagination (last episode number in current page)
          example: 12
        hasMoreResults:
          type: boolean
          description: Whether more results are available
          example: true
    Segment:
      type: object
      required:
        - id
        - uuid
        - position
        - status
        - startTime
        - endTime
        - content
        - contentLength
        - contentSpanishMt
        - contentEnglishMt
        - isNsfw
        - episode
        - mediaId
        - storage
        - hashedId
      properties:
        id:
          type: integer
          description: Auto-generated segment ID
          example: 12345
        uuid:
          type: string
          description: Unique identifier for the segment
          example: 3fd94cef-a3e1-31ae-bc8d-e743f03e9c7e
        position:
          type: integer
          description: Position of the segment within the episode
          example: 1133
        status:
          type: integer
          description: Segment status (0=Deleted, 1=Active, 2=Suspended, 3=Verified, 100=Invalid Sentence, 101=Sentence Too Long)
          enum:
            - 0
            - 1
            - 2
            - 3
            - 100
            - 101
          example: 1
        startTime:
          type: string
          description: Timestamp in H:MM:SS.ffffff format indicating when the segment starts
          example: '0:33:27.255000'
        endTime:
          type: string
          description: Timestamp in H:MM:SS.ffffff format indicating when the segment ends
          example: '0:33:28.464000'
        content:
          type: string
          maxLength: 500
          description: Original Japanese content of the segment
          example: 僕は僕で、君は君だ。
        contentLength:
          type: integer
          description: Length of the content
          example: 10
        contentSpanish:
          type: string
          maxLength: 500
          nullable: true
          description: Spanish translation of the segment content
          example: Yo soy yo, y tú eres tú.
        contentSpanishMt:
          type: boolean
          description: Whether the Spanish translation was machine-translated
          example: false
        contentEnglish:
          type: string
          maxLength: 500
          nullable: true
          description: English translation of the segment content
          example: I am me, and you are you.
        contentEnglishMt:
          type: boolean
          description: Whether the English translation was machine-translated
          example: false
        isNsfw:
          type: boolean
          description: Whether the segment contains NSFW content
          example: false
        imageUrl:
          type: string
          nullable: true
          description: URL to segment screenshot/image (generated from storage + hashedId)
          example: https://cdn.nadeshiko.co/media/7674/1/0d39e46b14.webp
        audioUrl:
          type: string
          nullable: true
          description: URL to segment audio file (generated from storage + hashedId)
          example: https://cdn.nadeshiko.co/media/7674/1/0d39e46b14.mp3
        actorJa:
          type: string
          nullable: true
          description: Japanese voice actor name
          example: Mamoru Miyano
        actorEs:
          type: string
          nullable: true
          description: Spanish voice actor name
          example: Alejandro Levis
        actorEn:
          type: string
          nullable: true
          description: English voice actor name
          example: J. Michael Tatum
        episode:
          type: integer
          description: Episode number this segment belongs to
          example: 1
        mediaId:
          type: integer
          description: Media ID this segment belongs to
          example: 7674
        storage:
          type: string
          enum:
            - local
            - r2
          description: Storage backend for segment assets
          example: r2
        hashedId:
          type: string
          description: Hash identifier for the segment
          example: 0d39e46b14
    CharacterWithMedia:
      type: object
      description: Character with all media appearances
      required:
        - id
        - nameJapanese
        - nameEnglish
        - imageUrl
        - seiyuu
        - mediaAppearances
      properties:
        id:
          type: integer
          description: AniList character ID
          example: 14545
        nameJapanese:
          type: string
          description: Japanese name of the character
          example: 真城最高
        nameEnglish:
          type: string
          description: English name of the character
          example: Moritaka Mashiro
        imageUrl:
          type: string
          format: uri
          description: Character image URL
          example: https://s4.anilist.co/file/anilistcdn/character/large/b14545.jpg
        seiyuu:
          $ref: '#/components/schemas/Seiyuu'
        mediaAppearances:
          type: array
          description: All media this character appears in
          items:
            type: object
            properties:
              media:
                $ref: '#/components/schemas/Media'
              role:
                type: string
                enum:
                  - MAIN
                  - SUPPORTING
                  - BACKGROUND
                description: Character role in this media
                example: MAIN
    SeiyuuWithRoles:
      type: object
      description: Seiyuu with all voice acting roles
      required:
        - id
        - nameJapanese
        - nameEnglish
        - imageUrl
        - roles
      properties:
        id:
          type: integer
          description: AniList staff ID
          example: 95991
        nameJapanese:
          type: string
          description: Japanese name of the voice actor
          example: 阿部敦
        nameEnglish:
          type: string
          description: English name of the voice actor
          example: Atsushi Abe
        imageUrl:
          type: string
          format: uri
          description: Profile image URL
          example: https://s4.anilist.co/file/anilistcdn/staff/large/n95991.jpg
        roles:
          type: array
          description: All characters voiced by this seiyuu with their media appearances
          items:
            type: object
            properties:
              character:
                $ref: '#/components/schemas/Character'
              media:
                $ref: '#/components/schemas/Media'
              role:
                type: string
                enum:
                  - MAIN
                  - SUPPORTING
                  - BACKGROUND
                description: Character role in this media
                example: MAIN
    ListWithMedia:
      type: object
      description: List with all media in order
      required:
        - id
        - name
        - type
        - userId
        - visibility
        - media
      properties:
        id:
          type: integer
          description: List ID
          example: 123
        name:
          type: string
          description: Name of the list
          example: Bakuman Series
        type:
          type: string
          enum:
            - SERIES
            - CUSTOM
          description: Type of list
          example: SERIES
        userId:
          type: integer
          description: User ID who owns the list (1 = admin)
          example: 1
        visibility:
          type: string
          enum:
            - PUBLIC
            - PRIVATE
          description: Visibility of the list
          example: PUBLIC
        media:
          type: array
          description: All media in the list, sorted by position
          items:
            type: object
            properties:
              position:
                type: integer
                description: Position in the list (1-indexed)
                example: 1
              media:
                $ref: '#/components/schemas/Media'
    ReindexRequest:
      type: object
      description: Request to reindex segments from the database into Elasticsearch
      properties:
        media:
          type: array
          description: |-
            Array of media to reindex. If not provided, all media will be reindexed.
            Each media can optionally specify which episodes to reindex.
            If episodes are not specified for a media, all episodes will be reindexed.
          items:
            type: object
            required:
              - mediaId
            properties:
              mediaId:
                type: integer
                description: The ID of the media
                example: 5
              episodes:
                type: array
                description: |-
                  Optional array of episode numbers to reindex.
                  If not provided, all episodes for this media will be reindexed.
                items:
                  type: integer
                example:
                  - 1
                  - 3
                  - 5
          example:
            - mediaId: 5
              episodes:
                - 1
                - 3
            - mediaId: 10
    ReindexResponse:
      type: object
      description: Response from the reindex operation
      properties:
        success:
          type: boolean
          description: Whether the reindex operation completed successfully
        message:
          type: string
          description: Human-readable message about the reindex operation
        stats:
          type: object
          description: Statistics about the reindex operation
          properties:
            totalSegments:
              type: integer
              description: Total number of segments processed
            successfulIndexes:
              type: integer
              description: Number of segments successfully indexed
            failedIndexes:
              type: integer
              description: Number of segments that failed to index
            mediaProcessed:
              type: integer
              description: Number of media items processed
        errors:
          type: array
          description: Array of errors that occurred during reindexing (if any)
          items:
            type: object
            properties:
              segmentId:
                type: integer
                description: ID of the segment that failed
              error:
                type: string
                description: Error message
  examples:
    AuthCredentialsRequired:
      summary: Authentication Credentials Required
      value:
        code: AUTH_CREDENTIALS_REQUIRED
        title: Authentication Credentials Required
        detail: No API key or session credentials were provided. Please include an Authorization Bearer token or a valid session cookie.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 401
    AuthCredentialsInvalid:
      summary: Invalid Authentication Credentials
      value:
        code: AUTH_CREDENTIALS_INVALID
        title: Invalid Authentication Credentials
        detail: The provided API key or session credentials are invalid. Please check your credentials and try again.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 401
    AuthCredentialsExpired:
      summary: Expired Authentication Credentials
      value:
        status: 401
        code: AUTH_CREDENTIALS_EXPIRED
        title: Expired Authentication Credentials
        detail: Your credentials are not valid anymore. Please sign in again or create a new API key.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
    InsufficientPermissions:
      summary: Insufficient Permissions
      value:
        code: INSUFFICIENT_PERMISSIONS
        title: Insufficient Permissions
        detail: 'Your account lacks the required permissions to perform this action. Required permissions: {permissions}.'
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 403
    RateLimitExceeded:
      summary: Rate Limit Exceeded
      value:
        code: RATE_LIMIT_EXCEEDED
        title: Rate Limit Exceeded
        detail: You have made too many requests. Please slow down and try again later.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 429
    QuotaExceeded:
      summary: Quota Exceeded
      value:
        code: QUOTA_EXCEEDED
        title: Quota Exceeded
        detail: You have exceeded your monthly API quota. Please upgrade your plan or wait until next month.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 429
    InternalServerError:
      summary: Internal Server Error
      value:
        code: INTERNAL_SERVER_EXCEPTION
        title: Internal Server Error
        detail: An unexpected error occurred on our end. Please try again later. If the problem persists, please report this issue.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 500
    ValidationFailed:
      summary: Validation Failed
      value:
        code: VALIDATION_FAILED
        title: Validation Failed
        detail: The request data did not pass validation rules. Please check the errors field for details.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 400
        errors:
          query: Required
          limit: Must be a positive integer
          email: Invalid email format
    InvalidJson:
      summary: Invalid JSON
      value:
        code: INVALID_JSON
        title: Invalid JSON
        detail: The request body contains invalid JSON that could not be parsed. Please check the syntax.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 400
    NotFound:
      summary: Not Found
      value:
        code: NOT_FOUND
        title: Not Found
        detail: The requested resource could not be found. Please check the URL and try again.
        type: https://github.com/BrigadaSOS/Nadeshiko/issues/new?template=bug_report.yml
        instance: trace-id-placeholder
        status: 404
  responses:
    UnauthorizedApiKey:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            AuthCredentialsRequired:
              $ref: '#/components/examples/AuthCredentialsRequired'
            AuthCredentialsInvalid:
              $ref: '#/components/examples/AuthCredentialsInvalid'
            AuthCredentialsExpired:
              $ref: '#/components/examples/AuthCredentialsExpired'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            InsufficientPermissions:
              $ref: '#/components/examples/InsufficientPermissions'
    TooManyRequests:
      description: Too Many Requests
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            RateLimitExceeded:
              $ref: '#/components/examples/RateLimitExceeded'
            QuotaExceeded:
              $ref: '#/components/examples/QuotaExceeded'
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            InternalServerError:
              $ref: '#/components/examples/InternalServerError'
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            ValidationFailed:
              $ref: '#/components/examples/ValidationFailed'
            InvalidJson:
              $ref: '#/components/examples/InvalidJson'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            NotFound:
              $ref: '#/components/examples/NotFound'
    EpisodeListResponse:
      description: Paginated list of episodes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EpisodeListResponse'
    EpisodeResponse:
      description: Single episode response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Episode'
    SegmentResponse:
      description: Single segment response
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Segment'
